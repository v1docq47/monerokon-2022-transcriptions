# Konrad Baechler, Marco Purtschert & Brian Boss

_**Konrad Baechler, Marco Purtschert & Brian Boss - Trying to De-Anonymize I2P Network Participants**_

_Trying to De-Anonymize I2P Network Participants and its Relation to Crypto Swaps Involving Monero #MoneroKon2022 Monero Konferenco | Day 1_

_https://odysee.com/@diva.exchange:d_  

[https://youtu.be/C8qtPl74Uso](https://youtu.be/C8qtPl74Uso)

---

_**Konrad:**_ Hello, everyone. My name is Konrad from diva.exchange. This is the presentation held at MoneroKon 2022 in Lisbon, and we have done the re-recording of this presentation to improve audio and video. This year is a co-presentation together with two researchers. They have done research at the Lucerne University of Applied Science and Arts in Switzerland and the title of this presentation is the Results of the Research. And they were trying to de-anonymize I2P network participants. Since diva.exchange is a fully distributed exchange for cryptocurrencies, it’s especially interesting how their work relates to swaps also involving Monero.

Now first a few words about diva.exchange. We’re a not-for-profit organization and open association based in Switzerland, so everybody can join and help us to develop the fully distributed and private exchange for digital values. That’s why by the way we’re called “diva” it stands for “digital values” and we’re just a bunch, a loose bunch of developers and researchers. So please feel free to join, it’s free to join, you’re going to learn a lot. What we do is, as we said, we create a fully distributed and totally private exchange, and since it’s fully distributed there is no business model involved — in a distributed world this is pretty pointless.

What’s the agenda of this presentation — it’s the intro, so you are here, and then I’d like to talk quickly about the project status of diva.exchange, then Marco and Brian, the two researchers, are going to present their work, and we’re going to have a short outro. And if you do have questions, you can ask them over social media.

The scope of diva.exchange is, as I said, to build a completely distributed and totally private network of own banks. So diva.exchange is banking technology, free banking technology for everyone. Why is it free? Because the license itself is AGPL version 3, so it’s a true open source license, so the code and all the stuff is truly free. The lowest level, and this is also a very interesting level, is I2P, which is a private overlay network. And on top of this we have the Divachain, which is a blockchain as a PBFT implementation, it’s no coin involved — it’s built something fault tolerant. On top of that we do have, so that’s what we call “storage”, on top of that we do have a user interface, and we call this user interface “diva”. Now once you install this stack on your own computer, never forget if you don’t have the keys — you don’t own the values. So everything which you install with diva is totally local — there is no central entity involved in running your own free bank. As soon as you did that, you join the I2P network and your stack implements the business logic of being your own bank.

Now what we did as developers in the past. We created an I2P SAM library, which is now quite popular, you can look at it and get repositories at GitHub or code berg. We also developed diva chain which is a complete new blockchain, which works over I2P, and we believe it’s one of the only one which really works over I2P, so that the whole with metadata, which is involved in banking technology is totally private. We did this from scratch. Then we developed the diva protocol, which is the banking logic, the exchange logic, the business logic. We do have a UI prototype called “diva”, and we dockerized everything so that’s quite easy for developers to get started.

Where we are is that Divachain works really stable, which was hard work to make it work over I2P. I2P as a total private overlay network is quite challenging to implement applications on top of it, because there are quite some network challenges to solve, and we did that, And we had a very smooth experience with Monero, so with the backend. So, for example, to implement transactions towards Monero nodes which are running also locally. Obviously same is true for Bitcoin or for Ethereum. And we do research together with Swiss universities, currently we’re doing this with three — one of the very important partners is the Lucerne University of Applied Science and Arts in Switzerland.

Our next challenges are things like we want to do the swaps with Monero versus Bitcoin, versus Ethereum, and some other coins, to prove how Divachain works. So this is what we’re working currently on. And we’re doing additional research, because we’re very skeptical people, and the things which is truly important to us is quality. So if we’re not running a destructive approach and trying to destroy our own works, we can’t trust ourselves, because we don’t like blue skies scenarios, we’re really skeptical. So we’re trying to do great research and difficult research on our own implementations and also on stuff like I2P.

Now please let’s have a focus on I2P. And I’d like to hand over the presentation to Marco and Brian, the two researchers. Do itself is diva.exchange is only the research partner, so we’re not interfering with the results the Lucerne University of Applied Sciences and Arts is looking at the quality of the research work. That’s really important to us. Now following the teaser video, where the two researchers have produced, and then the presentation of the research results. Thank you.

_**Brian:**_ Welcome, I am Brian.

_**Marco:**_ Hello, and I’m Marco.

_**Brian:**_ Welcome to our presentation about trying to de-anonymize I2P network participants. Our research title was “De-anonymization of Participants of the I2P-based Trading Network for Digital Assets”. We are two students from the Lucerne University of Applied Science and Arts.

_**Marco:**_ A few words about this presentation. The presentation will be simplified, meaning there will be a trade-off between profound and understandability. So if you want to have more information about our research, or if you want to read into our research, you can read our paper, it’s open source, you can read it on our university’s portfolio database. We will call here on this presentation only the main scope of the research, which is primarily one attack we’ve researched. And the focus is on the I2Pd client which is the C++ implementation from our research, but it’s also applied to the I2P client, which is the Java implementation.

A few words about the problem from our research. As there are many services who store the B32-address of its participant in the I2P network, the B32-address is like the address for the participants inside the I2P network, there are many services who store this like, for example, registry services or also diva.exchange tries to do this, and many of the storages are public available. So our research problem or the question of our research is: “Is it possible to infer the IP address from those stored B32-addresses?” because if this would be possible, then there would be a highly privacy problem through the whole I2P network.

_**Brian:**_ For a better understanding about what I2P is, we will give you a short introduction. I2P stands also for the Invisible Internet Project. It is a decentralized and distributed peer-to-peer overlay network, like Tor. There are multiple implementations of the router, like the Java or the C++, and its main goal is to provide security for anonymisation from the communication, for the source and the destination of each participant.

What is I2P not. To understand what the goal at hand, and you have to understand what I2P isn’t, I2P does not try to disguise itself, if you are a participant of it. There are parts of I2P that are centralized, and like the Reseed Server, which there are about 13 at the moment, which are used for bootstrapping.

_**Marco:**_ Another really important part for understanding I2P are the tunnels, because tunnels are used in I2P to anonymize that source and destination from each other, so that they don’t know who the exact source and who the exact destination is. Here on this example you see Alice and Bob, Alice is trying to send a message to Bob, and Bob probably sending requests, you could also imagine as if Alice would be a normal client and Bob would be a web server. Here you see the tunnels, they are unidirectional, meaning there are separate tunnels for sending and receiving traffic. As you can see if Alice wants to send her message to Bob, Alice sends a message to her outbound tunnel, to the inbound gateway from Bob, there it goes to the inbound tunnel from Bob, Bob proceeds the message and sends the answer to his own outbound tunnel and into Alice inbound tunnel back to Alice.

And also a key part for making possible that’s the transaction is happening is that the participants don’t know the position. The outbound gateways and endpoints, they must know that posit their position because they have to proceed messages depending on where they are, but the participants won’t know where they are. For example the participants in outbound tunnel right after Alice don’t know that he’s there, in this part, in this tunnel. It could also be, or he could also think that he is in the outbound tunnel from Bob or somewhere else. So this is really key part from these tunnels and how they make the organization possible.

The some other interesting facts is that default length is two to three hops, and default amount from total are two in and two out runnels for sending and receiving messages. And another key part for our attack is that the tunnel renewal is 10 minutes, meaning that every 10 minutes the tunnels are renewed, meaning if all the participants are available, the tunnel will be renewed for another 10 minutes so all the participants are in there, and if another participant isn’t available he will be replaced, the variable participant will be taken over into the next tunnel.

_**Brian:**_ And for a full understanding you’ll also need to know what the NetDB is. NetDB is a distributed network database that is used inside of I2P to share information between each node. It is a distributed hash table which is based on the Kademlia algorithm. The NetDB inside of I2P mainly has two information stored — these are the RouterInfos and LeaseSets. A RouterInfo contains information about individual routers, especially the IP address and the port on which the router is connectable. Also there is the LeaseSet, the LeaseSet contains a set of router info, how another service and a B32-address is reachable. These are RouteInfos which also contain the tunnel IDs of the IN-gateways, which you should connect to, if you try to reach this service.

The LeaseSet contains the information about the IN-gateway of the inbound tunnel. In this example if Alice tries to reach Bob, it’s gonna look for the LeaseSet of Bob and will find information about multiple inbound gateways for Bob, which it sends then it’s data to.

_**Marco:**_ Now a few words about attacks we’ve driven. We analyzed multiple P2P attacks, and it’s really important to note that no malware injection was involved. In all our attacks covered we only tried to attack the protocol itself, meaning there was no manipulation other than on our own clients. All the participants we want to connect, who aren’t in the control of us, weren’t touched and weren’t manipulated. And all our attacks were covered on a theoretical level, meaning we started to build a test network for attack simulation, but because this was a highly complex topic, we couldn’t finish it, the test network for attack simulation, so we call it attack on a theoretical level, meaning more research is later needed. But from periodic standpoints those attacks seems to work.

And now about the main scope of our research — this was a tunnel takeover,  which mainly the combination from a Sybil and intersection attack. Sybil attack, for people who don’t know, is an attack where you try to flood a network with own manipulated routers and trying to get a majority or part of a majority of network, and trying to influence its behavior. And an intersection attack is where you try to go inside the tunnel and intersect the tunnel there.

In a nutshell or what about covering what attacks is about, and it’s really important to know the attack we will cover is about mass attacking a network, so meaning we trying not to de-anonymize one participant on one router in particular. We’re trying to make an attack on the whole network, and try to figure out who we can de-anonymize without any specific target in mind. And attack is based on statistical probability, meaning there’s no hundred percent guarantee, but repeating the attack will increase its probability. And also very important, the attack we present is about figuring out the position of the participants inside the tunnel, because as we code before, in the tunnel explanation, participants don’t know their exact position, but if they know their exact position, then you can deanonymise a target, because if you know that you control the first and the last hop inside the tunnel, then you only would need two participants or two ratings in a tunnel, but since the participants don’t know the information, this isn’t possible. So we tried to find out a way to figure out that we control the first and last hop, and this is how we did it.

_**Brian:**_ As Marco already explained with the tunnel takeover, its goal is to take over a tunnel of a target, in the example shown, we try to take over that an inbound tunnel of Bob. Normally if you would just have all of the participants, you had already de-anonymization of Bob, because you would see the complete traffic, not the inside of the traffic but where it is go. Our goal was to show how we can do this with not having to own all three of the routers or if you would have longer or shorter tunnels of the all participants.

The main idea was to get at least two participants inside the tunnel. This is the first one, the gateway, and the last one. This is because of two reasons that the last one of the participants in the entire example knows the IP address of Bob, because it has to send its traffic, it receives the data to Bob itself. Normally it doesn’t know that Bob is the end point, but this is the goal of this attack and to get hold of. Every information we gather we have to send to a server, where the known information are getting analyzed and set together. So we can be sure that we have the de-anonymization of the target. The evil gateway is needed because it’s the first entry point, and we know of Bob, that means the gateway is already known, and it’s easy to see if we have control over this participant, because it’s known its role, and if we have luck or we find another way how to position, that it’s pretty easy to see.

Now the other way to get the last participant is to see if the gateway sends, if the communication between the gateway and the participant is with the same middleman. All these information are sent to the analysis server, where they are analyzed, and we try to recreate the tunnel. If we see that evil gateway and the evil participants are communicating with the same middlemen, we can hope, because we do not have a hundred percent guarantee, that it really is the same tunnel, and that we have a tunnel overtaken.

What now we can do on side of the client with the reverse-lookup of the LeaseSet, I can try to find the B32-address of Bob and look for our own gateway we control, if it’s inside the LeaseSet, if we know that, and the information from the evil participant of the IP-address, we will have a sum with some luck we have find Bob. So IP address and B32-address.

As I explained, we with the LeaseSet and the whole tunnel taken over or parts of the tunnel, and the router information, information from the evil participants we have the deanonymisation of Bob.

_**Marco:**_ Now after we figure out this attack, we try to get some information from this attack, and try to figure out, how we can mitigate this attack, and how different aspects and different parameters from this, the different resources, who are involved in the tech can be mitigated, and how to influence the situation. So we tried to mesh all this information into formula, which is seen here. I won’t go into detail of this formula, because it’s really complicated, but if you’re interested in how this works, it’s explained more in our research paper. But with this formula it’s possible to plot such nice graphs like this, where you can get some really useful information.

For example, here we tried to figure out how the tunnel lengths influence the infiltration rate of tunnels. For example, here we could calculate or figure out that longer tunnels will mitigate this attack, especially this special kind of attack. And if you can see, if you have a tunnel length from two or three hops, you’re already pretty neat covered, especially if an attacker tries a simple attack, but it tries to take over 10, 20 percent from the network. But if you have a two-thirds majority, meaning he has control deal of the same network, it will take a lot more tunnels for information for delivering this attack, meaning more tunnels equals spread mitigation against this attack, especially because it’s harder with this kind of attack for an attacker to figure out that he has control over the last participant inside the tunnel.

Another thing we can show here is that more tunnels is meaning that an attack has more possibilities to make this attack, because for example if one participant has doubled the amount of tunnels that actually have double the amount of tries for this special tunnel configuration.

_**Brian:**_ An alternative for tunnel takeover as aspect of luck to have the participants in the right position is to combine it with a DDoS attack. And that idea behind this is to flood targeted participant of a tunnel so it doesn’t get renewed and used in a new renewal of the tunnel. This is especially useful if you already know the B32- address of a service. The first step you would do is identify the inbound tunnel. This you can do with the LeaseSet of Bob —  there you can see all of the of the gateways and the tunnels there are and pick one of your choice.

The next step would be to do a DDoS. This can happen via, if you just send too many requests, just one thing you can do that and this a part of I2P is that you send a lot of tunnel requests to this router. And with on a specific threshold the gateway will not accept any other new tunnel requests again until the threshold is going down. And this you will have to repeat on until your own tunnels, your own routers are at the right positions. And if you have some luck, like we have in this example, that the last one participant were already there, because we have a Sybil attack in place, so we had only just to DDoS that evil to the gateway until a router from our own and set of participants was there.

And as mitigation steps there would be to use longer tunnels, because especially for the DDoS attack this would make it harder to take it over, and you would need more participants inside the tunnel, and to have all the information you need for that the analyzation.

Another way would be to have less tunnels, and this is problematic, because at the standard, in the default settings there are only used two per tunnel, per pool, this means if you would only use one, and one would drop out, you have no backup, and the connection to I2P would be less stable.

Another one would be have two variable tunnel lengths. This would mean that for each tunnel the router would decide to use more or less, and participants would have less impact on the network, because of all tunnels would have to be longer, but it would also increase and it would make it harder to guess how long a tunnel is, because you do not know as an attacker. That means if you have the two right participants, if you have a tunnel of four, a 50/50 chance there is another participant or there is really Bob. So you have to have extra work to be sure that your attack was successful.

_**Marco:**_ And for a conclusion, our main conclusion was that the I2P network is resistant against most or nearly all common attacks, meaning the I2P community did a really great work for figuring out where its mitigation, can all the different attacks possible against P2P networks, like I2P is. This was also the reason why we only could cover theoretical attacks and more practical, so meaning for most people I2P is a really viable option. But what we also figure out is that deanonymization within I2P can not completely be ruled out, because some high complex attacks as shown before are still possible. Our main two attacks we covered in our complete research was the two colluding routes inside the tunnel, like one attack we’ve shown you before. There is the main mitigation against this attack from I2P is that you don’t know where participants are positioned. So you have to figure this out which is some kind of more or less strong mitigation. And the another attack we’ve covered in our research, but not in this presentation, is a traffic analysis on ISP or even state, or possibly even interstate level actor, where you try to figure out the flow from I2P traffics, and try to deanonymise a target like this.

Their mitigation is some background noise from I2P, and also trying to make it as hard as possible for injection, meaning packages can be checked, any of their flags and the packet size from the tunnels, are always the exact same size making it harder to figure out where traffic will flow.

But the main conclusion from our research is that more research is needed, because as more research us will flow into I2P and also other online network was more resistant against other attacks it will be and as more usable and more viable, and as more people are using I2P and more research the better it will be. Thank you for attention.

_**Konrad:**_ Thank you Marco and Brian for these insights into your research work. Now back to diva.exchange. I’d like to introduce you to the codebase which is on GitHub, mirrored from codeberg. There you find all the AGPL version 3 licensed source code, which we produce at diva.exchange to produce the fully distributed and private banking technology for everyone. So feel free to join there. Please, use codeberg, if you do have issues, because this is our main repository.

At Monerokon 2022 we had as a giveaway the so-called “Di’lemma” elderberry syrup with us, which got picked up by the community very nicely. There was a Monero tag to pay a bit to the developers of the diva.exchange at the bottom of the bottle. So thank you very much for your donations, and please feel free to donate some Monero to us to appreciate our work at dive.exchange or simply join our association or even better commit some code to our repositories. Now we called by the way this elderberry or this elderflower syrup “Di’lemma” because we see lots of dilemmas in the area of privacy, especially the dilemma of not having a business model where we’re absolutely happy with it, but others seem to need a business model to produce fully distributed exchanges. So, for example, this is an interesting dilemma and everyone in the community will have his own views on how to solve that. The same is true for privacy and for communication — there are quite some dilemmas around.

Last but not least, if you do have questions regarding diva.exchange or regarding the research work we’re performing, please feel free to contact us over the social media. There is Mastodon available, there is Twitter available, there is a Telegram channel available called diva.exchange.chat. Please join us on Telegram, on Twitter, or also on Mastodon to talk to us. Thank you very much for your attention, have a good time.
