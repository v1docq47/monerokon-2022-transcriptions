# Конрад Бехлер, Марко Пуртшерт и Брайан Босс

_**Конрад Бехлер, Марко Пуртшерт и Брайан Босс — Попытка деанонимизации участников I2P сети**_

_Попытка деанонимизации участников I2P-сети и ее связь со свопами с участием Monero #MoneroKon2022 Monero Konferenco | День 1_

_https://odysee.com/@diva.exchange:d_  

[https://youtu.be/C8qtPl74Uso](https://youtu.be/C8qtPl74Uso)

---

_**Конрад:**_ Привет всем. Меня зовут Конрад. Я из компании diva.exchange. Это презентация, показанная на MoneroKon 2022 в Лиссабоне. Мы перезаписали презентацию, чтобы улучшить звук и видео. В этом году мы выступаем совместно с двумя исследователями из Люцернского университете прикладных наук и искусств, который находится в Швейцарии, и презентация называется «Результаты исследования», в рамках которой они попытались деанонимизировать участников I2P сети. Поскольку diva.exchange — это полностью распределённая криптовалютная биржа, нам особенно интересно то, как их работа связана со свопами с использованием Monero.

И сначала несколько слов о diva.exchange. Мы являемся некоммерческой организацией и открытой ассоциацией, расположенной в Швейцарии. Абсолютно любой может присоединиться и помочь нам в развитии распределённой и приватной биржи для обмена цифровых активов. Поэтому, кстати, мы и называемся diva, что означает digital values, «цифровые ценности». Мы — это просто группа, группа независимых разработчиков и исследователей. Так что, пожалуйста, не стесняйтесь, присоединяйтесь — вы многому научитесь. Как уже было сказано, мы обеспечиваем возможность распределённого и полностью приватного обмена, и поскольку процесс полностью распределён, он не предусматривает никакой бизнес-модели — в мире распределённых систем это довольно бессмысленно.

Это план данной презентации. Сначала это небольшое вступление, затем я бы хотел коротко рассказать о текущем состоянии проекта diva.exchange, затем Марко и Брайан, два исследователя, представят результаты своей работы, а затем будет небольшое заключение. И если у вас возникнут вопросы, вы сможете задать их в социальных сетях.

Как уже было сказано, целью проекта diva.exchange является создание распределённой и полностью приватной сети собственных банков. Таким образом, diva.exchange — это банковская технология, свободная банковская технология, доступная абсолютно. Почему она свободная? Потому что доступ к ней предлагается по лицензии AGPL, её третьей версии, то есть, это настоящая лицензия с открытым исходным кодом, так что код и всё прочее действительно предоставляются бесплатно. Самый нижний уровень, и это очень интересный уровень — I2P, который представляет собой приватную оверлейную сеть. А поверх этого нами был реализован Divachain, блокчейн использующий алгоритм PBFT, то есть, в нём нет монет, а в основе лежит его отказоустойчивость. Поверх этого мы реализовали то, что называем «хранилищем», а поверх него — пользовательский интерфейс, который мы также называем diva. После установки этого стека на свой компьютер никогда не забывайте, что если вы не владеете ключами, то вы не владеете и активами. Поэтому всё, что вы устанавливаете с помощью diva, устанавливается локально — нет никакого центрального органа, который бы участвовал в управлении вашим собственным банком. Как только вы всё становите, вы станните участником I2P сети, и стек реализует всю бизнес-логику вашего собственного банка.

Теперь о том, что мы как разработчики сделали в прошлом. Мы создали библиотеку I2P SAM, которая сейчас довольно популярна, вы можете изучить её и скачать в нашем репозитории на GitHub или Codeberg. Мы также разработали Divachain, совершенно новый блокчейн, работающий на базе I2P, и мы считаем, что это один из единственных блокчейнов, который действительно работает с I2P, так что все метаданные, которые использует наша банковская технология, абсолютно приватны. Мы сделали всё с нуля, а затем разработали протокол diva, который отвечает за банковскую логику, логику обмена, бизнес-логику. У нас есть прототип пользовательского интерфейса под названием diva, и мы все докеризировали, чтобы разработчикам было проще начать работу.

Мы добились стабильности работы Divachain, и нам стоило большого труда заставить его работать через I2P. I2P сеть как полностью приватная оверлейная сеть довольно сложна с точки зрения реализации приложений поверх неё, поскольку возникает довольно много проблем сетевого уровня, требующих решения, но мы сделали это, И у нас был очень позитивный опыт работы с Monero как с бэкендом, например, при реализации возможности проведения транзакций узлами Monero, которые также работают локально. Очевидно, то же самое верно для Bitcoin или Ethereum. Мы также проводим совместные исследования со швейцарскими университетами. В настоящее время мы работаем сразу с тремя, и одним из важнейших партнёров для нас является Люцернский университет прикладных наук и искусств.

В дальнейшем мы собираемся решить проблему свопов Monero-Bitcoin, Monero-Ethereum и некоторых других монет, чтобы доказать работоспособность Divachain. Вот над чем мы работаем в настоящее время. Мы проводим дополнительные исследования, потому что мы очень скептически настроены, и для нас по-настоящему важно качество. Поэтому, если мы не станем использовать деструктивный подход и пытаться уничтожить результаты собственной работы, мы не сможем доверять себе, потому что нам не нравятся «законы голубого неба», так что да, мы скептики. И именно поэтому мы стараемся проводить масштабные и сложные исследования собственных вариантов реализаций, а также таких вещей, как I2P.

А теперь перейдём непосредственно к I2P, и я хотел бы передать слово двум исследователям, Марко и Брайану. Компания diva.exchange является исключительно партнёром по исследованиям, и мы никак не влияем на их результаты — за качеством исследовательской работы следуит Люцернский университет прикладных наук и искусств. Это действительно важно для нас. Сейчас сначала будет показано вступительное видео, а затем — презентация с результатами исследований. Спасибо.

_**Брайан:**_ Здравствуйте, меня зовут Брайан.

_**Марко:**_ Привет, я — Марко.

_**Брайан:**_ Добро пожаловать на нашу презентацию, посвящённую попытке деанонимизации участников I2P сети. Наше исследование называется «Деанонимизация участников торговой сети для обмена цифровых активов на базе I2P». Мы — два студента Люцернского университета прикладных наук и искусств.

_**Марко:**_ Сначала несколько слов о презентации. Она будет упрощённой, то есть, мы попытаемся достигнуть компромисса между её глубиной и доступностью. Поэтому, если вы захотите получить больше информации о нашем исследовании или более подробно ознакомиться с его результатами, вы можете прочитать нашу работу, которая находится в открытом доступе в базе данных нашего университета. В рамках данной презентации мы коснёмся только основной области исследования, то есть, рассмотрим один тип атаки, который исследовали. Основное внимание будет уделено I2Pd клиенту, реализованному на C++, но всё сказано в равной степени будет применимо к I2P клиенту, реализованному на Java.

Несколько слов о сути проблемы, которую мы пытались решить с помощью нашего исследования. Поскольку существует множество сервисов, сохраняющих B32-адрес участника I2P сети, а B32-адрес — это адрес, используемый участниками внутри I2P сети, итак, есть много сервисов, которые сохраняют его, например, сервисы реестра или diva.exchange, которые также  пытаются делать это, и многие из хранилищ при этом являются общедоступными. И проблема, рассматриваемая в рамках нашего исследования, заключается в следующем: «Возможно ли вывести IP-адрес на основе сохранённых B32-адресов?» Ведь если такое возможно, то мы имеем дело с проблемой приватности всей I2P сети.

_**Брайан:**_ Чтобы лучше понять, что такое I2P, мы сделаем небольшое вступление. I2P расшифровывается как Invisible Internet Project — «невидимый интернет». Это децентрализованная и распределённая одноранговая оверлейная сеть, подобная Tor. Существует множество вариантов маршрутизаторов, например, написанные на Java или C++, и главная цель такой сети состоит в обеспечении безопасности и приватности передаваемых данных, а также сокрытия местоположения отправителя и адресата.

Теперь о том, чем не является I2P. Это необходимо знать, чтобы понять, какова была наша цель. I2P сеть не пытается замаскировать саму себя, если вы являетесь её участником. Некоторые части I2P централизованы, например, Reseed Server, которых на данный момент насчитывается около 13, и которые используются для самозагрузки и самонастройки.

_**Марко:**_ Другой важной для понимания I2P составляющей являются туннели, потому что они используются в I2P для анонимизации источника и получателя, чтобы никто не знал, кто точно является источником и кто точно является получателем данных. Здесь в качестве примера мы взяли Элис и Боба. Элис пытается отправить Бобу сообщение, а Боб отправляет соответствующие запросы. Вы также можете представить, что Элис — это обычный клиент, а Боб является веб-сервером. Здесь также показаны туннели. Они однонаправленные, то есть существуют туннели отдельно для отправки и отдельно для получения трафика. Как видно, если Элис захочет отправить сообщение Бобу, она отправит сообщение в свой исходящий туннель, во входящий шлюз Боба, там оно попадёт во входящий туннель Боба, Боб обработает сообщение и отправит ответ через свой исходящий туннель во входящий туннель Элис.

Кроме того, ключевым моментом, необходимым для проведения транзакции является то, чтобы участники не знали своего местоположения. Исходящие шлюзы и конечные точки должны знать своё местоположение, потому что они должны передавать сообщения в зависимости от того, где находятся, но участники этого знать не должны. Например, участники в исходящем туннеле сразу после Элис не знают, что находятся там, в этой части, в этом туннеле. Такой участник также может находиться или думать, что находится в исходящем туннеле Боба или где-то ещё. Так что это по-настоящему важный аспект в случае с туннелями и тем, как они организуются.

Ещё несколько интересных фактов: длина туннеля по умолчанию составляет от двух до трёх транзитных узлов, а общее их количество по умолчанию равно двум входящим и двум исходящим туннеля для получения и отправки сообщений, соответственно. И ещё одна важная для моделирования нашей атаки деталь: обновление туннеля происходит каждые 10 минут, то есть если все участники доступны, туннель будет обновлен ещё на 10 минут и все участники останутся в нём, и если какой-то участник станет недоступен, он будет заменён, и другой участник будет переведён в следующий туннель.

_**Брайан:**_ Для полного понимания также необходимо знать, что такое NetDB. NetDB — это распределённая сетевая база данных, которая используется в I2P для обмена информацией между узлами. Это распределённая таблица хешей, построенная на базе алгоритма Kademlia. В NetDB в основном хранятся два типа информации: RouterInfos и LeaseSets. RouterInfo содержит информацию об отдельных маршрутизаторах, в частности, IP-адрес и порт, через который подключён маршрутизатор. Также существует LeaseSet, который содержит набор данных о маршрутизаторе, а также о том, как связаться с другим сервисом и соответствующий B32-адрес. RouteInfos, также содержат идентификаторы туннелей входящих шлюзов, к которым вы необходимо подключиться, чтобы связаться с сервисом.

Итак, LeaseSet содержит информацию о входящем шлюзе входящего туннеля. В нашем примере, если Элис попытается связаться с Бобом, она будет искать LeaseSet Боба, где найдёт информацию о нескольких входящих шлюзах Боба, на которые и отправит свои данные.

_**Марко:**_ Теперь несколько слов об атаках. Мы проанализировали несколько видов P2P-атак, и очень важно отметить, что не использовали при этом вредоносного программного обеспечения. При проведении всех атаках мы пытались атаковать только сам протокол, то есть не прибегали ни к каким манипуляциям. Мы задействовали только наши собственные клиенты. Все те участники, которых мы хотели подключить, не контролировались нами, не были никак затронуты и не подвергались манипуляциям. И все наши атаки носили теоретический характер, то есть, мы начали строить свою тестовую сеть для моделирования атак, но поскольку это очень сложная задача, мы не смогли её выполнить, поэтому мы называем это атакой на теоретическом уровне, и в дальнейшем необходимо провести некоторые дополнительные исследования. Но с циклической точки зрения эти атаки, похоже, работают.

А теперь поговорим об основной цели нашего исследования, которая заключалась в захвате туннеля, который, по сути, представляет собой комбинацию из атаки Сибиллы и атаки пересечения. Для тех, кто не знает, при проведении атаки Сибиллы злоумышленник пытается заполнить сеть собственными контролируемыми им маршрутизаторами и захватить её большую часть, чтобы затем влиять на её поведение. А атака пересечения — это когда вы пытаетесь войти в туннель и перехватить трафик.

В двух словах о том, на что были направлены атаки, поскольку очень важно понимать, что атака, которую мы рассмотрим, заключалась в массовой атаке на сеть. То есть, мы не пытались деанонимизировать отдельного участника сети на отдельном маршрутизаторе. Мы пытались провести атаку на всю сеть и выяснить, кого можем деанонимизировать без какой-либо конкретной цели. Атака была основана на статистической вероятности, то есть, не давала стопроцентной гарантии, но повторение атаки увеличивало вероятность успеха. И ещё очень важно то, что атака, о которой мы говорим, заключается в выявлении местоположения участников внутри туннеля, потому что, как мы уже говорили, в рамках туннеля участники не знают своего точного местоположения, но если оно им известно, то мы можем деанонимизировать цель, потому что, если вы контролируете первый и последний транзитный узел туннеля, то вам понадобится только два участника в туннеле. Но поскольку участникам не известна такая информация, это невозможно. Поэтому мы попытались найти способ, который бы позволил контролировать первый и последний транзитные узлы, и вот, как мы это сделали.

_**Брайан:**_ Как уже объяснял Марко, цель состояла в захвате туннеля, и в приведённом примере мы пытаемся захватить входящий туннель Боба. Как правило, если бы у вас была  информация обо всех участниках, вы бы уже деанонимизировали Боба, потому что вы бы видели весь трафик — не его внутреннюю часть, а то, куда он направлен. Нашей целью было показать, как мы можем это сделать, не имея данных всех трёх маршрутизаторов, или же при наличии более длинных или коротких туннелей у всех участников.

Основная идея заключалась в том, чтобы внутри туннеля оказалось как минимум два участника. Первый, шлюз, и последний. Тому есть две причины: последнему из участников известен IP-адрес Боба, потому что ему нужно направить свой трафик, и он сам получает данные Боба. Обычно он не знает, что Боб является конечной точкой, но это и есть цель данной атаки — завладеть информацией. Всю собранную информацию мы должны отправить на сервер, где она будет проанализирована и собрана воедино. Таким образом, мы сможем быть уверенными в деанонимизации цели. Вредоносный шлюз необходим потому, что это первая точка входа, и мы знаем о Бобе, то есть шлюз уже известен, и легко понять, есть ли у нас контроль над этим участником, потому что нам известна его роль. И если нам повезло, или мы нашли другой способ определения местоположения, то это довольно легко понять.

Другой способ узнать последнего участника — посмотреть, осуществляется ли связь между шлюзом и участником через одного и того же посредника. Вся эта информация отправляется на специальный сервер, где она анализируется, после чего мы пытаемся воссоздать туннель. Если мы видим, что вредоносный шлюз и вредоносные участники обмениваются информацией с одними и теми же посредниками, мы можем надеяться, поскольку у нас нет стопроцентной гарантии, что это действительно один и тот же туннель, и что нам удалось захватить его.

Теперь со стороны клиент, осуществив обратный просмотр LeaseSet, мы можем попытаться найти B32-адрес Боба и поискать наш собственный шлюз, который мы контролируем. И если он находится внутри LeaseSet, если нам известно это, и мы обладаем информацией об IP-адресе, полученной от вредоносного участника, то при некоторой доле везения мы найдём Боба. Итак, нам нужен IP-адрес и B32-адрес.

Как я уже объяснял, с помощью LeaseSet и захваченного туннеля или его части, а также информации о маршрутизаторе, информации, получаемой от вредоносных участников, мы можем деанонимизировать Боба.

_**Марко:**_ Теперь, после того как мы определили суть атаки, мы попытаемся получить на её основе некоторую информацию и выяснить, как можно смягчить последствия, а также определить связанные с ней аспекты и параметры, какие ресурсы необходимы для её проведения, и как мы можем повлиять на ситуацию в целом. И мы попытались свести всю полученную информацию в показанную здесь формулу. Я не буду вдаваться в подробности формулы, потому что она очень сложная, но если вам интересно, как это работает, то подробнее обо всём написано в нашей исследовательской работе. Но с помощью этой формулы можно построить вот такие графики, из которых можно почерпнуть действительно полезную информацию.

Например, мы попытались выяснить, как длина туннеля влияет на скорость проникновения в туннели. Тут мы рассчитали и выяснили, что более длинные туннели смягчают последствия атаки, особенно этого особого её  вида. Как видно, при длине туннеля от двух или трёх транзитных узлов, вы уже достаточно хорошо защищены, особенно если злоумышленник пытается провести простую атаку, пытается захватить 10 или 20 процентов сети. Но если вы контролируете две трети сети, это означает, что вы имеете контроль над всей сетью, и потребуется гораздо больше туннелей для получения информации, необходимой для проведения этой атаки. То есть, большее количество туннелей равносильно усилению защиты от такой атаки, в частности потому, что злоумышленнику будет труднее понять, контролирует он последнего участника туннеля или нет.

Также мы продемонстрировать, что большее количество туннелей означает большее количество вероятностей при проведении атаки, поскольку, например, если один участник удваивает количество туннелей, у него фактически удваивается количество попыток конкретно для этой конфигурации туннеля.

_**Брайан:**_ Альтернативой захвата туннеля, повышающей шанс удачной атаки, если участники находятся в правильном положении, является сочетание с DDoS-атакой. Идея заключается в том, чтобы забросать запросами целевого участника туннеля так, чтобы он не был обновлён и задействован в обновлённом туннеле. Это будет особенно эффективно, если вам уже известен B32-адрес сервиса. Первый шаг в данном случае заключается в определении входящего туннеля. Это можно сделать с помощью LeaseSet Боба — там можно будет увидеть все имеющиеся шлюзы и туннели и выбрать один нужный.

Следующим шагом будет сама DDoS-атака. Она проводится путём простой отправки слишком большого количества запросов, которые являются частью I2P, на конкретный маршрутизатор. И по достижении определённого порогового значения шлюз не сможет принимать новые запросы до тех пор, пока порог не снизится. И это придётся повторять до тех пор, пока ваши собственные туннели, ваши собственные маршрутизаторы не окажутся нужном местоположении. И если вам повезёт, как в нашем примере, последний участник окажется там, потому что мы провели атаку Сибиллы, и теперь нам нужно было просто проводить DDoS-атаку на шлюз, пока маршрутизатор из нашего собственного набора участников не окажется в нужном месте.

В качестве мер по смягчению последствий можно было бы использовать более длинные туннели, потому что, особенно в случаен DDoS-атаки, это усложнит захват, и вам понадобится больше участников внутри туннеля, чтобы собрать всю информацию, необходимую для проведения анализа.

Другой способ — использовать меньше туннелей, и это проблематично, потому что в стандартных настройках по умолчанию используется только два туннеля на пул. А это означает, что если вы будете использовать только один туннель, и один выпадет, то у вас не будет резервной копии, и соединение с I2P станет менее стабильным.

Как вариант также можно использовать переменную длину туннеля. Это означает, что для каждого туннеля маршрутизатор решает использовать больше или меньше транзитных узлов, и участники оказывают меньшее влияние на сеть, потому что все туннели должны быть длиннее. Но это также усложняет процесс определения длины туннеля, потому что вы как атакующий не можете знать его. Это означает, что если у вас есть два правильных участника, а туннель состоит из четырёх, вероятность того, что будет ещё один участник и им действительно окажется Боб, составит 50/50. Поэтому вам придется проделать дополнительную работу, чтобы убедиться в том, что ваша атака была успешной.

_**Марко:**_ И в заключение, наш главный вывод заключается в том, что I2P сеть устойчива к большинству или почти ко всем распространенным видам атак, что означает, что сообщество I2P проделало по-настоящему большую работу, чтобы выяснить, как противостоять самым различным атакам, которые могут быть проведены против P2P сетей, таких как I2P. Это также стало причиной того, что мы смогли охватить только теоретический аспект, а не практический. Так что для большинства людей I2P сеть действительно является вполне жизнеспособным вариантом. Но мы также выяснили, что деанонимизация в рамках I2P не может быть исключена полностью, поскольку некоторые сложные виды атаки, как было показано ранее, по-прежнему возможны. Два основных вида атаки, рассмотренные в нашем полном исследовании, предусматривали наличие двух сговорившихся маршрутизаторов внутри туннеля, как в случае с одной из атак, которую мы продемонстрировали вам ранее. Основное средство защиты от такой атаки на I2P сеть заключается в том, что злоумышленник не будет знать, где расположены участники. Поэтому ему придётся выяснять это, что является более или менее сильным средством защиты. И еще один рассмотренный нами в исследовании вид атаки, о котором мы не рассказали в этой презентации, — это анализ трафика провайдером интернет-услуг или даже на государственном, или, возможно, даже межгосударственном уровне, когда реализуется попытка выделить поток данных из I2P-трафика с последующей деанонимизацией цели.

Смягчить последствия можно посредством введения некоторого фонового шума в I2P сети, а посредством затруднения возможности вмешательства, то есть, сделать так, чтобы пакеты проверялись, и любой из их флагов и сам размер пакетов, проходящих через туннели, всегда был одинаков, что затруднило бы определение направления трафика.

Но главный вывод нашего исследования заключается в том, что необходимы дальнейшие исследования, потому что чем больше исследований будет проводиться в отношении I2P, равно как и других сетей, тем устойчивей они станут к другим видам атак — они станут более удобными и жизнеспособными. И чем больше людей будет пользоваться I2P, и чем больше исследований будет проведено, тем лучше будет сеть. Спасибо за внимание.

_**Конрад:**_ Спасибо Марко и Брайану за рассказ об их исследовательской работе. И теперь вернёмся к diva.exchange. Я хотел бы познакомить вас с кодовой базой, которая опубликована на GitHub и является зеркалом того, что было размещено на Codeberg. Там вы найдете весь исходный код который мы создаём и распространяем с diva.exchage в соответствии с третьей версией лицензии AGPL, чтобы создать доступную для всех распределённую и приватную банковскую технологию. Так что, обязательно посетите эти ресурсы. Пожалуйста, если у вас возникнут проблемы, заходите на Codeberg, потому что это наш основной репозиторий.

На Monerokon 2022 нами предлагался так называемый бузинный сироп под названием Di’lemma, который пользовался спросом у сообщества. На дне бутылки была метка Monero, чтобы разработчики diva.exchange могли немного заработать. Так что большое спасибо за ваши пожертвования, и, пожалуйста, не стесняйтесь жертвовать немного Monero, чтобы оценить нашу работу на dive.exchange, или просто присоединяйтесь к нашей ассоциации, а ещё лучше — добавьте немного кода в наши репозитории. Кстати, мы назвали этот сироп Di’lemma, потому что видим много дилемм, связанных с приватностью, в частности, дилемму отсутствия бизнес-модели, что нас вполне устраивает, но другим, похоже, нужна бизнес-модель для создания распределённых бирж. Так что, это интересная дилемма, и у каждого в сообществе будут свои взгляды на то, как её решить. То же самое касается приватности и передачи данных — здесь тоже есть немало дилемм.

И последнее, если у вас возникли вопросы относительно diva.exchange или исследовательской работы, которую мы проводим, пожалуйста, свяжитесь с нами через социальные сети. У нас есть каналы в Mastodon, Twitter, есть канал в Telegram под названием diva.exchange.chat. Пожалуйста, присоединяйтесь к нам в Telegram, в Twitter или в Mastodon, чтобы пообщаться. Большое спасибо за внимание, всего доброго!
